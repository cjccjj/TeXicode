<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>TeXicode</title>

  <style>
    :root { color-scheme: light dark; }

    body {
      font-family: sans-serif;
      margin: 0;
      height: 100vh;
      display: flex;
      flex-direction: column;
      background: var(--bg);
      color: var(--fg);
    }

    header {
      padding: 0.5em 1em;
      background: var(--header-bg);
    }

    header a {
      color: var(--header-fg);
      text-decoration: none;
      font-size: 1.4em;
      font-weight: bold;
    }

    main { flex: 1; display: flex; overflow: hidden; }

    .panel {
      flex: 1;
      display: flex;
      flex-direction: column;
      border: 1px solid var(--border);
    }

    .panel-header {
      text-align: center;
      padding: 0.7em;
      border-bottom: 1px solid var(--border);
      user-select: none;
      cursor: pointer;
      transition: background 0.2s;
      font-weight: bold;
      background: var(--panel-header-bg);
      color: var(--panel-header-fg);
    }

    .panel-header:hover { background: var(--panel-header-hover-bg); }

    textarea {
      flex: 1;
      width: 100%;
      border: none;
      resize: none;
      font-family: monospace;
      font-size: 14px;
      padding: 1em;
      box-sizing: border-box;
      outline: none;
      background: var(--textarea-bg);
      color: var(--textarea-fg);
    }

    @media (prefers-color-scheme: light) {
      :root {
        --bg: #ffffff;
        --fg: #000000;
        --header-bg: #333;
        --header-fg: #fff;
        --border: #ccc;
        --panel-header-bg: #f0f0f0;
        --panel-header-hover-bg: #e0e0e0;
        --panel-header-fg: #000;
        --textarea-bg: #fff;
        --textarea-fg: #000;
      }
    }

    @media (prefers-color-scheme: dark) {
      :root {
        --bg: #121212;
        --fg: #eee;
        --header-bg: #1f1f1f;
        --header-fg: #fff;
        --border: #444;
        --panel-header-bg: #2a2a2a;
        --panel-header-hover-bg: #3a3a3a;
        --panel-header-fg: #fff;
        --textarea-bg: #1e1e1e;
        --textarea-fg: #fff;
      }
    }
  </style>
</head>
<body>
  <header>
    <a href="https://github.com/dxddxx/TeXicode" target="_blank">TeXicode</a>
  </header>

  <main>
    <div class="panel input-panel">
      <div class="panel-header" id="copy-input">Copy Input</div>
      <textarea id="input" placeholder="Type LaTeX equation here…"></textarea>
    </div>

    <div class="panel output-panel">
      <div class="panel-header" id="copy-output">Copy Output</div>
      <textarea id="output" class="output" readonly></textarea>
    </div>
  </main>

  <script>
    const API_URL = "https://chat.nopshop.com/texicode-api/render";

    const input = document.getElementById("input");
    const output = document.getElementById("output");

    // Debounce updates a bit
    let timer;
    input.addEventListener("input", () => {
      clearTimeout(timer);
      timer = setTimeout(updateOutput, 300);
    });

    async function updateOutput() {
      const text = input.value.trim();
      if (!text) {
        output.value = "";
        return;
      }

      try {
        const res = await fetch(API_URL, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ input: text })
        });

        if (!res.ok) {
          output.value = "Error: " + res.status + " " + res.statusText;
          return;
        }

        const data = await res.json();
        output.value = data.output ?? "";
      } catch (err) {
        output.value = "Network or API error: " + err;
        console.error(err);
      }
    }

    function addCopyHandler(id, getTextFn, baseLabel) {
      const el = document.getElementById(id);
      el.addEventListener("click", async () => {
        try {
          await navigator.clipboard.writeText(getTextFn());
          const original = el.textContent;
          el.textContent = "Copied!";
          setTimeout(() => (el.textContent = baseLabel), 1000);
        } catch (e) {
          console.error("Clipboard error", e);
        }
      });
    }

    addCopyHandler("copy-input", () => input.value, "Copy Input");
    addCopyHandler("copy-output", () => output.value, "Copy Output");
  </script>
</body>
</html>